<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <!--to make new release change all product id, package id and version number-->
  <Product Id="*" Name="Terminals" Language="1033" Version="3.3.0.0" Manufacturer="Robert Chartier"
           UpgradeCode="1010280c-d106-47d5-abea-630ebe57887d">
    <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />
    <!-- consider variable Id="*"-->
    <MajorUpgrade DowngradeErrorMessage="A newer version of Terminals is already installed." />

    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
    <Property Id="INSTALLTYPE" Secure="yes" Value="0"></Property>

    <WixVariable Id="WixUIBannerBmp" Value="WixUIBannerBmp.bmp" />
    <WixVariable Id="WixUIDialogBmp" Value="WixUIDialogBmp.bmp" />
    <UIRef Id="WixUI_InstallDirCustom" />

    <Media Id="1" Cabinet="AppToInstall.cab" EmbedCab="yes" />

    <Feature Id="ProductFeature" Title="Terminals" Level="1">
      <ComponentGroupRef Id="MainComponents" />
      <ComponentRef Id="ApplicationShortcut" />
    </Feature>

    <!--TODO custom action
    <Binary Id="WixCustomAction.CA.dll" src="..\WixCustomAction\bin\$(var.Configuration)\WixCustomAction.CA.dll" />
    <CustomAction Id="FinalizeCustomAction" Return="check" Execute="immediate" BinaryKey="WixCustomAction.CA.dll" DllEntry="CustomActionEntry" />
    <InstallExecuteSequence>
      <Custom Action="FinalizeCustomAction" After="InstallFinalize">NOT Installed</Custom>
    </InstallExecuteSequence>-->
  </Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="Terminals" />
      </Directory>
      <Directory Id="ProgramMenuFolder">
        <Directory Id="TerminalsProgramsFolder" Name="Terminals"/>
      </Directory>
    </Directory>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="MainComponents" Directory="INSTALLFOLDER">
      <Component Id="TerminalsExe" Guid="31F8007A-749F-4A74-AB3B-1F80813CEA32">
        <File Source="$(var.Terminals.TargetPath)" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="GranadosDll" Guid="9748FD50-3853-4FF5-AC40-4F737F4A261A">
        <File Source="$(var.Granados.TargetPath)" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="HexEditorDll" Guid="A280B61A-9FA2-469C-9DC0-1D356FA35603">
        <File Source="$(var.HexEditor.TargetPath)" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="MetroDll" Guid="8737AA17-03D4-4E4E-81F9-734029698ECF">
        <File Source="$(var.Metro.TargetPath)" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="SharpPcapDll" Guid="29188BD1-307E-4CD0-9750-BF294FD0E902">
        <File Source="$(var.SharpPcap.TargetPath)" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="SqlScriptRunnerDll" Guid="88E4FB8E-9517-4BEE-9974-B7A1316F78B4">
        <File Source="$(var.SqlScriptRunner.TargetPath)" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="SSHClientDll" Guid="DF5AEE72-4C84-49EF-A59E-2664AA51685D">
        <File Source="$(var.SSHClient.TargetPath)" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="TabControlDll" Guid="97B4B57A-C0D8-49D2-B75F-9B2B8F253A65">
        <File Source="$(var.TabControl.TargetPath)" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="TerminalEmulatorDll" Guid="61B42519-1D0B-4012-8095-F0D7D04A6566">
        <File Source="$(var.TerminalEmulator.TargetPath)" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="VncSharpDll" Guid="C15DFED3-F776-43BE-90BE-483DE2D2E86E">
        <File Source="$(var.VncSharp.TargetPath)" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="zlibNetDll" Guid="3D6ADB9B-B6B1-4D4D-964D-6EE4B261720A">
        <File Source="$(var.zlib.net.TargetPath)" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="ZedGraphDll" Guid="AA750DC1-73E6-4EEE-9BA4-E4CE495FA721">
        <File Source="..\..\Resources\Libraries\ZedGraph\ZedGraph.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="ZedGraphxml" Guid="5FA61E24-3D81-4FB5-9F1C-815364D02844">
        <File Source="..\..\Resources\Libraries\ZedGraph\ZedGraph.xml" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="AWSSDKDll" Guid="DBF4B812-5D46-4A8A-9777-13E21FA92C8A">
        <File Source="..\..\Resources\Libraries\AmazonS3\AWSSDK.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="AxMSTSCLibDll" Guid="6449EDAA-0362-45BC-859D-6EFFAC7FC328">
        <File Source="$(var.Terminals.TargetDir)AxInterop.MSTSCLib.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="MSTSCLibDll" Guid="E3D11298-2D80-4650-8139-3350BB646B2C">
        <File Source="$(var.Terminals.TargetDir)MSTSCLib.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="VMRCLibDll" Guid="F9944517-DA84-4846-BF81-606494EA96FA">
        <File Source="..\..\Resources\Libraries\VMRC\AxInterop.VMRCClientControlLib.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="VMRCInterOpDll" Guid="5631D23A-0599-40FA-8937-39BC422A9377">
        <File Source="..\..\Resources\Libraries\VMRC\Interop.VMRCClientControlLib.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="AxWFICALibDll" Guid="E3A4BF7F-538C-40F3-A5D0-736E2478E9AE">
        <File Source="..\..\Resources\Libraries\Citrix\AxWFICALib.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="WFICALibDll" Guid="3329874C-3276-4FCF-953D-67FB490F0BAF">
        <File Source="..\..\Resources\Libraries\Citrix\WFICALib.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="EntityFrameworkdll" Guid="BA34A96D-0A5D-402E-A01C-5B20B89C4973">
        <File Source="..\packages\EntityFramework.5.0.0\lib\net40\EntityFramework.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="EntityFrameworkXml" Guid="C64657D8-F6AF-4A58-8E23-05EBFA8411C1">
        <File Source="..\packages\EntityFramework.5.0.0\lib\net40\EntityFramework.xml" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="FlickrNetdll" Guid="1A7B8896-0BCD-4B2A-BB92-D204164D010B">
        <File Source="..\..\Resources\Libraries\Flicker\FlickrNet.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="SharpZipLibdll" Guid="97DB6873-E7A3-4010-8EEB-F82D37472275">
        <File Source="..\packages\SharpZipLib.0.86.0\lib\20\ICSharpCode.SharpZipLib.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="log4netdll" Guid="B2F1F15C-34C3-453E-9521-A8F3949D99C2">
        <File Source="..\packages\log4net.2.0.0\lib\net40-full\log4net.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="log4netxml" Guid="4BDE5756-0063-42E7-8971-C46573017B2C">
        <File Source="..\packages\log4net.2.0.0\lib\net40-full\log4net.xml" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="TransPort2006" Guid="220FA6F3-1C60-4F32-9E82-31D635E8B551">
        <File Source="..\..\Resources\Libraries\TransPort2006\TransPort2006.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="TransPort2006Design" Guid="299E6518-5760-4C45-8E88-34B2B8ADA50A">
        <File Source="..\..\Resources\Libraries\TransPort2006\TransPort2006.Design.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="Wpcapdll" Guid="F01CBCE4-5C1A-4FFB-A48D-1ECA1B933B92">
        <File Source="..\..\Resources\Libraries\wpcap\wpcap.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="Terminalslog4netConfig" Guid="EA925B16-4657-44BC-8ED8-895D2098CFA9">
        <File Source="..\Terminals\Terminals.log4net.config" KeyPath="yes"/>
      </Component>
      <!--Cant pickup from project dir, because the name is changed in target dir-->
      <Component Id="TerminalsExeConfig" Guid="417C609C-A07B-4CCB-8E2E-BADA86CA8341">
        <File Source="$(var.Terminals.TargetDir)Terminals.exe.config" KeyPath="yes"/>
      </Component>
      <Component Id="ToolStripSettingsConfig" Guid="B36A15AF-40C3-49ED-9CAB-15529527468B">
        <File Source="..\Terminals\ToolStrip.settings.config" KeyPath="yes"/>
      </Component>
      <Component Id="MainIcon" Guid="77AAEF17-7034-441B-B853-879DA390251C">
        <File Source="..\Terminals\terminalsicon.ico" KeyPath="yes"/>
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <DirectoryRef Id="TerminalsProgramsFolder">
      <Component Id="ApplicationShortcut" Guid="42B36D8B-C5D6-493C-A794-D158800D9229">
        <Shortcut Id="ApplicationStartMenuShortcut"
             Name="Terminals" Description="Terminals is a secure, multi tab terminal services/remote desktop client."
             Target="[INSTALLFOLDER]Terminals.exe" WorkingDirectory="INSTALLFOLDER">
          <Icon Id="terminalsicon.ico" SourceFile="..\Terminals\terminalsicon.ico"/>
        </Shortcut>
        <RemoveFolder Id="TerminalsProgramsFolder" On="uninstall"/>
        <RegistryValue Root="HKCU" Key="Software\Robert Chartier\Terminals" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>
  </Fragment>
</Wix>